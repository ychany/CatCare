{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h1 class="mb-4">펫보험 서비스</h1>
    
    {% if user_pets %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">내 반려동물</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <select class="form-select" id="petSelect" required>
                                    <option value="">반려동물 선택</option>
                                    {% for pet in user_pets %}
                                    <option value="{% url 'insurance:recommend' pet.id %}">{{ pet.name }}</option>
                                    {% endfor %}
                                </select>
                                <button class="btn btn-primary mt-2" onclick="goToRecommend()">추천받기</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            반려동물 프로필을 먼저 등록해주세요.
            <a href="{% url 'pets:pet_register' %}" class="alert-link">등록하러 가기</a>
        </div>
    {% endif %}
    
    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-search fa-3x mb-3 text-primary"></i>
                    <h5 class="card-title">보험 추천받기</h5>
                    <p class="card-text">내 반려동물에게 맞는 보험을 찾아보세요.</p>
                    <button type="button" class="btn btn-outline-primary" onclick="goToRecommend()">
                        추천받기
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-balance-scale fa-3x mb-3 text-success"></i>
                    <h5 class="card-title">상품 비교하기</h5>
                    <p class="card-text">보험 상품을 비교해보세요.</p>
                    <button type="button" class="btn btn-outline-success" onclick="goToCompare()">
                        상품 비교하기
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-question-circle fa-3x mb-3 text-info"></i>
                    <h5 class="card-title">보험 가이드</h5>
                    <p class="card-text">펫보험에 대해 알아보세요.</p>
                    <a href="#" class="btn btn-outline-info">
                        가이드 보기
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function goToRecommend() {
    var select = document.getElementById('petSelect');
    if (!select.value) {
        alert('반려동물을 선택해주세요.');
        return;
    }
    window.location.href = select.value;
}
function goToCompare() {
    var select = document.getElementById('petSelect');
    if (!select.value) {
        alert('반려동물을 선택해주세요.');
        return;
    }
    // pet id 추출 (URL에서 마지막 / 앞의 숫자)
    var petId = select.value.match(/(\d+)\/?$/);
    if (petId) {
        window.location.href = "{% url 'insurance:compare' %}?pet_id=" + petId[1];
    } else {
        alert('반려동물을 올바르게 선택해주세요.');
    }
}
</script>
{% endblock %} 